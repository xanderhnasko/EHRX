# VLM configuration (replaces LayoutParser detector)
vlm:
  # GCP project settings (can override with environment variables)
  # project_id: "your-gcp-project-id"  # Or set GCP_PROJECT_ID env var
  location: "us-central1"

  # Model selection
  model_name: "gemini-1.5-flash"  # gemini-1.5-flash or gemini-1.5-pro

  # API parameters
  max_tokens: 8192
  temperature: 0.1
  top_p: 0.95
  top_k: 40

  # Quality thresholds
  confidence_threshold_extraction: 0.85
  confidence_threshold_classification: 0.85
  confidence_threshold_overall: 0.85

  # Processing behavior
  enable_retry: true
  max_retries: 3
  retry_delay_seconds: 1.0

  # Cost tracking
  enable_cost_tracking: true
  cost_per_1k_input_tokens: 0.00025   # Gemini 1.5 Flash pricing
  cost_per_1k_output_tokens: 0.00075

  # Caching (optional)
  enable_caching: false
  cache_ttl_seconds: 3600

  # Timeout
  api_timeout_seconds: 60.0

  # Debugging
  save_raw_responses: false
  # raw_responses_dir: "./debug/vlm_responses"

ocr:
  engine: tesseract
  psm_text: 8           # single word - better for EHR text
  psm_table: 6          # uniform block - good for tables
  lang: eng
  preprocess:
    deskew: true
    binarize: true

tables:
  csv_guess: true       # heuristic row/col if grid not found
  min_row_height_px: 10
  y_cluster_tol_px: 6
  x_proj_bins: 40

hierarchy:
  heading_regex:
    - "^(PROBLEMS?|PROBLEM LIST)\\b"
    - "^(MEDICATIONS?|CURRENT MEDS?)\\b"
    - "^(ALLERG(IES|Y))\\b"
    - "^(LABS?|RESULTS?)\\b"
    - "^(VITALS?)\\b"
    - "^(IMAGING|RADIOLOGY)\\b"
    - "^(ASSESSMENT|PLAN|A/P)\\b"
    - "^NOTES?\\b"
  caps_ratio_min: 0.6
  gap_above_px: 18
  left_margin_tolerance_px: 20
  levels:
    H1: strong_keyword|big_gap
    H2: weaker_keyword|indented
    H3: bullets|numbered

privacy:
  local_only: true
  log_text_snippets: false   # never log OCR text

